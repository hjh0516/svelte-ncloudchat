Ncloud Chat JavaScript SDK 사용법에 대해 설명합니다.

## 요구 사양<a name="요구사양"></a>
Ncloud Chat JavaScript SDK를 사용하기 위한 요구 사양은 다음과 같습니다.
* Microsoft Edge 13 이상
* Chrome 16 이상
* Firefox 11 이상
* Safari  7 이상
* Opera 12.1 이상
* iOS Safari 7 이상
* Android Browser 4.4 (Kitkat) 이상

## SDK 설치 및 환경 구성 <a name="SDK설치및환경구성"></a>
JavaScript SDK를 사용하기 위한 기본 설정 방법은 다음과 같습니다. 
1. [ncloudchat.min.js](https://kr.object.ncloudstorage.com/ncloudchat/ncloudchat.min.js){target="_blank"}을 다운로드해 주십시오. 
2. 다운받은 파일을 ncloudchat.min.js를 head와 head 사이에 추가해 주십시오. 
    ```javascript
    <head><script src="ncloudchat.min.js"></script></head>
    ```

Ncloud Chat Javascript SDK 는 npm 패키지로 제공되며 yarn 을 통해서도 사용할 수 있습니다.
```javascript
# using npm
npm install ncloudchat

# using yarn
yarn add ncloudchat
```

### 인증<a name="인증"></a>

### 인스턴스 초기화  <a name="인스턴스초기화"></a>

Ncloud Chat을 사용하기 전에 인스턴스를 초기화해야 합니다. 대시보드에서 확인한 프로젝트 ID를 추가해 주십시오.

Ncloud Chat을 사용하기 전에 인스턴스를 초기화하는 방법은 다음과 같습니다. 

1. 대시보드에 접속하여 프로젝트 아이디를 확인해 주십시오. 
2. 인스턴스를 초기화하려면 아래 코드를 사용해 주십시오.  

```javascript
const nc = new ncloudchat.Chat();
nc.initialize(projectId);
```

### Ncloud Chat 연결  <a name="NcloudChat연결"></a>

- 초기화가 완료되면 사용자명, 이름, 프로필 이미지 주소(옵션)를 입력 후에 접속해야 합니다. 

```javascript
const user = await nc.connect({
    id: USERNAME,
    name: NAME,
    profile: PROFILE_URL
}, TOKEN);
```

| ID         | type   | desc        |
| :--------- | :----- | :---------- |
| USERNAME | string |  아이디 |
| NAME | string | 이름 |
| PROFILE_URL | string | 프로필 주소 |
| TOKEN | string | 토큰 |


:::(Warning) (주의)
 * 로그인시 보안을 위해 API 를 통해서 TOKEN 을 발급 받는걸 추천드립니다.
 * [API DOCS TOKEN 생성](https://api.ncloud-docs.com/docs/){target="_blank"} 을 API 를 통해 token 을 발급합니다. 발급된 토큰을 사용하실 수 있습니다.
 * 토큰 방식을 사용하지 않으실 경우 대시보드->보안설정-> Token 인증을 사용안함으로 설정해 주세요. 
:::



### Ncloud Chat 서버 연결 해제

 연결된 Ncloud Chat 소켓 서버와의 연결을 해제하려면  아래 코드를 사용해 주십시오.

```javascript
await nc.disconnect();
```

## 채널 구독 및 구독 해제  <a name="채널구독및구독해제"></a>


원하는 채널에 가입(방 참여) 합니다. 참여된 채널에는 unsubscribe 할때까지 재접속 시에도 자동으로 참여됩니다.

```javascript
await nc.subscribe(CHANNEL_ID);
```

해당 채널에 대한 가입을 해지합니다.  해당 채널에 메시지를 더 이상 받을 수 없습니다.
```javascript
await nc.unsubscribe(CHANNEL_ID);
```

| ID         | type   | desc        |
| :--------- | :----- | :---------- |
| CHANNEL_ID | string | 채널 아이디 |


## 메시지 전달 <a name="메시지전달"></a>

특정 채널에 메시지를 송신하려면 아래 코드를 사용해 주십시오. 

```javascript
await nc.sendMessage(CHANNEL_ID, {
      type: "text", 
      message: MESSAGE
});

// 특정 사용자 언급을 위한 맨션 사용시
await nc.sendMessage(CHANNEL_ID, {
      type: "text", 
      mentions: [USER_ID, USER_ID]
      message: MESSAGE
});
// 멘션을 보내는 또 다른 방법으로는 메시지내에 '@[ID]' 와 같이 입력할 경우 자동으로 멘션에 저장된다. 
```

| ID         | type   | desc               |
| :--------- | :----- | :----------------- |
| CHANNEL_ID | string | 채널 아이디        |
| type    | string | 보내는 메시지 종류 (text, image)  |
| MESSAGE    | string | 전송 메시지 텍스트 |
| MENTIONS | array | 멘션할 사용자 ID |


### 파일 업로드

- 특정 채널로 이미지 파일을 전송할 수 있습니다. 
```html
<input type="file" id="uploadfile" name="file" onChange={fileUpload} />
```

```javascript
await nc.sendImage(CHANNEL_ID,file);
```

| ID         | type   | desc               |
| :--------- | :----- | :----------------- |
| CHANNEL_ID | string | 채널 아이디        |
| file    | string | 보내는 메시지 종류  |


:::(Info) (참고)
 * 오브젝트 스토리지가 활성화 되어 있어야 합니다.
 * [Object Storage](https://www.ncloud.com/product/storage/objectStorage){target="_blank"} 상품과 연동한 후에 사용할 수 있습니다.
:::



## 이벤트 핸들러 연결 및 해제 <a name="이벤트핸들러연결및해제"></a>

다양한 수신하는 이벤트에 대해, 이벤트 핸들러를 등록 또는 해제할 수 있습니다,

```javascript
// 메시지 수신
nc.bind('onMessageReceived',function(channel, message) {        
});
// 오류 메시지
nc.bind('onErrorReceived',function(error) {
});
// 접속 성공
nc.bind('onConnected',function(socket) {
});
// 접속 종료
nc.bind('onDisconnected',function(reason) { 
});
```

## Client API

### 사용자 정보   <a name="사용자정보"></a>

 - Member Data Class 

| ID         | type   | desc          |
| :--------- | :----- | :------------ |
| id         | string | 사용자 ID |
| name | string | 사용자 이름  |

#### 사용자 정보 가져오기 <a name="사용자정보가져오기"></a>

특정 아이디에 대한 정보를 가져옵니다. (보안상 닉네임만 전달됩니다.)

```javascript
const filter = {id: USER_ID};
const sort = {created_at:-1};
const option = { };
const members = await nc.getMembers(filter, sort, option);
```

#### 채널 Subscription 데이터 가져오기 <a name="채널Subscription데이터가져오기"></a>

(특정 채널에 대해) 참여자 리스트를 가져올 수 있습니다.

```javascript
const filter = {channel_id:'CHANNEL_ID'};
const sort = {created_at:-1};
const option = { offset:0, per_page:100};
const subscriptions = await nc.getSubscriptions(filter, sort, option);
```

응용편
특정 채널에 온라인된 접속자 목록만 가져오기
filter 에 online 를 true 로 추가한다.
```javascript
const filter = {channel_id:channelId, online:true};
const sort = {created_at:-1};
const option = { offset:0, per_page:100};
const subscriptions = await nc.getSubscriptions(filter, sort, option);
console.log(subscriptions);
```
### 채널 구독  <a name="채널구독"></a>

 - Subscription Data Class 

| ID         | type   | desc          |
| :--------- | :----- | :------------ |
| id         | string | 유니크 아이디 |
| channel_id | string | 채널 아이디   |
| user_id    | string | 유저 고유 아이디   |
| created_at | string | 생성 일자     |
| online | boolean | 온라인 여부     |
| push | boolean | 푸시 참여 여부     |
| language | string | 접속 언어    |
| mark.user_id | string | 마지막 메시지 보낸 사용자     |
| mark.message_id | string | 마지막 메시지 아이디     |
| mark.sort_id | string | 마지막 메시지 정렬ID     |

#### 채널 Subscription 데이터 가져오기 <a name="채널Subscription데이터가져오기"></a>

(특정 채널에 대해) 참여자 리스트를 가져올 수 있습니다.

```javascript
const filter = {channel_id:channelId};
const sort = {created_at:-1};
const option = { offset:0, per_page:100};
const subscriptions = await nc.getSubscriptions(filter, sort, option);
```

### 채널 <a name="채널"></a>

 - Channel Data Class 

| ID         | type   | desc                         |
| :--------- | :----- | :--------------------------- |
| id         | string | 채널 아이디(unique)     |
| project_id | string | 프로젝트 아이디              |
| unique_id | string |  개발사에서 설정 가능한 채널 아이디 (unique) |
| name       | string | 채널 이름                  |
| user_id     | string | (채널을 생성한) 유저 아이디    |
| unique_id  | string | 채널 고유ID |
| default_lang | string | 기본 언어 |
| lang | string | 현재 접속중인 이용자의 언어 |
| members | string | Private 일 경우 참여된 사용자 목록 |
| push | boolean | 푸시 메시지 지원 여부 (Private 채널일 경우)
| state | boolean | 채널 상태 |
| created_at | string | 생성 일자                    |
| updated_at | string | 갱신 일자                    |


#### 채널 데이터 가져오기 <a name="채널데이터가져오기"></a>

프로젝트의 채널 데이터를 목록 형태로 가져오려면 아래 코드를 사용해 주십시오.

```javascript
const filter = {state:true};
const sort = {created_at:-1};
const option = { offset:0, per_page:100};
const channels = await nc.getChannels(filter,sort,option);
```

| ID         | type   | desc                         |
| :--------- | :----- | :--------------------------- |
| FILTER     | string    |  사용자가 사용할 필터 입니다. 모든 필드에 대해서 쿼리를 하실 수 있습니다.     |
| SORT     | string    | 정렬을 할 수 있습니다. (ascending (1) or descending (-1))          |
| OPTION    | string    | 페이징 및 선택 옵션들 추가할 수 있습니다. |

### 개별 채널 <a name="개별채널"></a>

- 개별 채널에 대한 정보를 가져올 수 있습니다.

```javascript
const channel = await nc.getChannel(id);
```

### 채널 생성

- 신규 채널을 생성합니다.

```javascript
const channel = await nc.createChannel({type:"PUBLIC",name:"CHANNEL NAME"});
```

### 채널 내에 사용자 초대
- PRIVATE 채널의 경우 참여하고자 하는 사용자를 초대합니다.

```javascript
 const channel = await nc.inviteMembers(channelId, [user_id,user_id]);
```

### 채널 삭제

- 해당 채널을 삭제합니다. (한 개 또는 여러 개를 삭제할 수 있습니다.)

```javascript
const channel = await nc.deleteChannel([CHANNEL_ID, CHANNEL_ID, CHANNEL_ID]);
```

### 채널 수정
- 채널 정보를 업데이트합니다.

```javascript
const channel = await nc.updateChannel({id: CHANNEL_ID, type:"PUBLIC",name:"CHANNEL NAME"});
```


#### 메시지 데이터 가져오기  <a name="메시지데이터가져오기"></a>

 - Message Data Class 

| ID         | type   | desc                         |
| :--------- | :----- | :--------------------------- |
| id         | string | 아이디(unique)     |
| message_id | string | 메시지 아이디              |
| sort_id | string |  메시지 정렬을 위한 ID |
| message_type       | string | 메시지 종류                  |
| sender.id     | string | 보낸 사람 ID   |
| sender.name  | string | 보낸 사람 이름 |
| sender.profile | string | 보낸 사람 프로필 이미지 |
| metions | string | 맨션된 리스트 |
| metions_everyone | string | 전체 맨션 여부 |
| content | string | 메시지
| created_at | string | 생성 일자                    |
| sended_at | string | 보낸 일자                    |

### 개별 메시지 정보

개별 메시지에 대한 정보를 가져올 수 있습니다.

```javascript
const channel = await nc.getMessage(message_id);
```

### 전체 메시지 정보

전체 메시지에 대해 가져올 수 있습니다.

```javascript
const filter = {channel_id: CHANNEL_ID};
const sort = {created_at:-1}; 
const option = { offset:0, per_page:100};
const messages = await nc.getMessages(filter, sort, option);
```

| ID         | type   | desc                         |
| :--------- | :----- | :--------------------------- |
| FILTER     | string    |  사용자가 사용할 필터 입니다. 모든 필드에 대해서 쿼리를 하실 수 있습니다.     |
| SORT     | string    | created_at: -1 or created_at:1 옵션만 사용가능 합니다.      |
| OPTION    | string    | 페이징 및 선택 옵션들 추가할 수 있습니다. |

#### 안 읽은 메시지 <a name="안읽은메시지"></a>

읽지 않는 메시지 수를 리턴합니다. 첫번째로 markRead 를 통해서 마지막 읽은 메시지의 정보를 전달합니다. 

```javascript
nc.markRead(channelId, {
    user_id: SENDER_ID, 
    message_id: MESSAGE_ID,
    sort_id: SORT_ID,
});
// 마크된  이후의 읽지 않은 메시지 전체 갯수를 리턴합니다.
nc.countUnread(CHANNEL_ID);
```

| ID         | type   | desc                         |
| :--------- | :----- | :--------------------------- |
| SENDER_ID     | string    |  메시지에 포함된 sender_id 를 넣어주세요.    |
| MESSAGE_ID     | string    |   메시지에 포함된 message_id 를 넣어주세요.    |
| SORT_ID    | string    | 메시지에 포함된 sort_id 를 넣어주세요. |


#### 메시지 번역 <a name="메시지번역"></a>

(자동번역 기능이 활성화 되어 있을 경우) 임의의 텍스트를 (지정한 언어로) 번역할 수 있습니다.

(Received) Translation Data Class

```javascript
const message = await nc.translateMessage(CHANNEL_ID, { source_lang: SORCE_LANG, target_lang: TARTGET_LANG, message: MESSAGE, direct: DIRECT });
```

| ID         | type   | desc                         |
| :--------- | :----- | :--------------------------- |
| SORCE_LANG     | string    |  원본 언어(source language)의 언어 코드    |
| TARTGET_LANG     | string    |   목적 언어(target language)의 언어 코드   |
| MESSAGE    | string    | 번역할 텍스트. 1회 호출 시 최대 5,000자까지 번역할 수 있습니다.|
| DIRECT | boolean | 번역된 메시지를 즉시 발송 합니다. (option) |


:::(Info) (참고)
 * 자동번역 기능이 활성화되어 있어야 합니다.
 * [Papago Translation](https://www.ncloud.com/product/aiService/papagoTranslation){target="_blank"} 상품과 연동한 후에 사용할 수 있습니다.
:::


#### 푸시 알림 <a name="푸시알림"></a>

Ncloud Chat 은 모바일 푸시만을 지원 합니다. 웹푸시는 아직 지원하지 않습니다.
